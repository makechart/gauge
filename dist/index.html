<div><div plug="layout"><div class="pdl-layout"><div data-type="layout"><div class="pdl-cell" data-name="view"></div><div class="text"><div class="pdl-cell" data-name="number">0000</div><div class="pdl-cell" data-name="unit">0000</div></div></div><div data-type="render"></div></div></div><style type="text/css">.pdl-layout>div[data-type=layout]{display:flex;justify-content:center;align-items:center}.pdl-layout>div[data-type=layout] .text{position:absolute;margin-left:.5em;width:100%;height:88%;top:12%;display:flex;flex-direction:column;justify-content:center;align-items:center}.pdl-layout>div[data-type=layout] [data-name=view]{width:100%;height:100%}.pdl-layout>div[data-type=layout] [data-name=number]{font-size:24px;line-height:1em}.pdl-layout>div[data-type=layout] [data-name=unit]{line-height:1em}</style><script type="@plotdb/block">var mod;module.exports={pkg:{name:"gauge",version:"0.0.1",extend:{name:"base",version:"0.0.1"},dependencies:[]},init:function(t){var e,n,i;e=t.root,n=t.context,i=t.pubsub;return i.fire("init",{mod:mod({context:n})})}};mod=function(t){var e,f,n,i;e=t.context;f=e.d3,n=e.chart;return{sample:function(){return{raw:[{value:Math.round(100*Math.random()),max:100,unit:"KG"}],binding:{value:{key:"value"},max:{key:"max"},unit:{key:"unit"}}}},config:(i=n.utils.config.from({preset:"default"}),i.text={numberSize:{type:"number",default:3,min:1,max:10,step:.1},unitSize:{type:"number",default:1,min:.5,max:10,step:.1}},i.wedge={percent:{type:"number",default:.7,min:0,max:1,step:.01}},i.pin={stroke:{type:"color",default:"#000"},strokeWidth:{type:"number",default:10},length:{type:"number",default:.33,step:.01,max:1,min:0}},i),dimension:{value:{type:"R",name:"value"},max:{type:"R",name:"max"},unit:{type:"N",name:"unit"}},init:function(){var t,e=this;this.tint=t=new n.utils.tint;this.arc=f.arc();this.n=Object.fromEntries(["view","number","unit"].map(function(t){return[t,e.layout.getNode(t)]}));this.g=Object.fromEntries(["view","number","unit"].map(function(t){return[t,f.select(e.layout.getGroup(t))]}));return this.v={number:0,unit:"",run:0}},parse:function(){},resize:function(){var t,e,n,i,r,a,u,s,h=this;t=[this.box.width,this.box.height],e=t[0],n=t[1];i=this.layout.getBox("view");r=this.layout.getNode("view");r.style.width=i.height+"px";this.sizeRate={number:this.cfg.text.numberSize,unit:this.cfg.text.unitSize};import$(this.v||(this.v={}),{number:(this.data[0]||{value:0}).value||0,unit:(this.binding.value||{}).unit||(this.data[0]||{unit:""}).unit||""});a=this.n.number;a.style.fontSize=this.sizeRate.number+"em";a.textContent=this.v.number;u=this.n.unit;u.style.fontSize=this.sizeRate.unit+"em";u.textContent=this.v.unit;this.r=s=Object.fromEntries(["number","unit"].map(function(t){return[t,e/(h.n[t].getBoundingClientRect().width||1)]}));(false||!this.cfg.enlarge?["number","unit"]:["unit"]).map(function(t){var e;return h.r[t]=(e=s[t])<1?e:1});this.n.number.style.fontSize=this.sizeRate.number*s.number+"em";this.n.unit.style.fontSize=this.sizeRate.unit*s.unit+"em";return this.layout.update(false)},render:function(){var t,e,n,i,r,a,u,s,h,o,l,c,m,d,p=this;if(this.cfg!=null&&this.cfg.palette){this.tint.set(this.cfg.palette.colors.map(function(t){return t.value||t}))}t=this.data[0]||{};if(!((this.percent||(this.percent={})).old!=null)){this.percent.old=0}if(this.percent.runningPin!=null){this.percent.old=this.percent.runningPin;delete this.percent.runningPin}this.percent.cur=e=(n=(i=(t.value||0)/(t.max||1))<1?i:1)>0?n:0;r=Math.PI/4;a=Math.PI*7/4;u=this.layout.getBox("view");s=Math.min(u.width,u.height)/2;this.arc.innerRadius(s*this.cfg.wedge.percent).outerRadius(s);h=s*(1-1/Math.sqrt(2))/2;o=this.g.view.selectAll("path.wedge").data([0,1]);o.exit().remove();o.enter().append("path").attr("class","wedge").attr("transform","translate("+u.width/2+","+(h+u.height/2)+") rotate(180)");l=this.g.view.selectAll("path.pin").data([0]);l.exit().remove();l.enter().append("path").attr("class","pin").attr("transform","translate("+u.width/2+" "+(h+u.height/2)+") rotate("+(45+270*e)+")").attr("d","M0 "+s*(1-this.cfg.pin.length)+"L0 "+s).attr("stroke-linecap","round");c=this.g.view.selectAll("citcle").data([0]);c.exit().remove();c.enter().append("circle");m=this.g.number.selectAll("text").data([0]);m.exit().remove();m.enter().append("text");d=this.g.unit.selectAll("text").data([0]);d.exit().remove();d.enter().append("text");this.g.view.selectAll("path.wedge").transition().duration(350).attr("transform","translate("+u.width/2+","+(h+u.height/2)+") rotate(180)").attrTween("d",function(t,i){return function(t){var e,n;t=f.easeCubicInOut(t);e=(p.percent.cur-p.percent.old)*t+p.percent.old;n=e*(Math.PI*6/4)+Math.PI/4;p.arc.startAngle(i===0?r:n).endAngle(i===0?n:a);return p.arc()}}).attr("fill",function(t,e){return p.tint.get(t)});this.g.view.selectAll("path.pin").transition().duration(350).attr("d","M0 "+s*(1-this.cfg.pin.length)+"L0 "+s).attr("fill","none").attr("stroke",this.cfg.pin.stroke).attr("stroke-width",this.cfg.pin.strokeWidth).attrTween("transform",function(t){return function(t){var e;t=f.easeCubicInOut(t);p.percent.runningPin=e=(p.percent.cur-p.percent.old)*t+p.percent.old;return"translate("+u.width/2+" "+(h+u.height/2)+") rotate("+(45+270*e)+")"}});this.g.number.selectAll("text").attr("font-size",this.sizeRate.number*this.r.number+"em").attr("dominant-baseline","hanging").text(Math.round(this.v.run));this.g.unit.selectAll("text").attr("font-size",this.sizeRate.unit*this.r.unit+"em").text(function(){return p.v.unit}).attr("dominant-baseline","hanging");return this.start()},tick:function(){var t=this;return this.g.number.select("text").text(function(){t.v.run=(t.v.number-t.v.run)*.1+t.v.run;if(t.v.run===t.v.number){t.stop()}return Math.round(t.v.run)})}}};function import$(t,e){var n={}.hasOwnProperty;for(var i in e)if(n.call(e,i))t[i]=e[i];return t}</script></div>